#!/bin/bash
# Muestra el estado del workspace actual o especificado

# Detectar directorio del script (compatible bash/zsh)
if [ -n "$BASH_SOURCE" ]; then
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
else
    SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
fi

# Cargar funciones compartidas
source "$SCRIPT_DIR/ws-common.sh"
source "$SCRIPT_DIR/ws-colors.sh"

# Determinar workspace: si hay argumento usarlo, sino auto-detectar
WORKSPACE_PATTERN=""

if [ -n "$1" ]; then
    # Workspace especificado expl√≠citamente
    WORKSPACE_PATTERN="$1"
else
    # Auto-detectar workspace actual
    WORKSPACE_PATTERN=$(detect_current_workspace 2>/dev/null || true)
    if [ -z "$WORKSPACE_PATTERN" ]; then
        error "‚ùå No est√°s dentro de un workspace"
        echo ""
        info "üí° Ejecuta este comando desde dentro de un workspace o especifica el nombre:"
        echo "   ws status <workspace>"
        echo ""
        echo "Ejemplos:"
        echo "  ws status              # desde dentro de un workspace"
        echo "  ws status feature-123  # desde cualquier lugar"
        exit 1
    fi
    info "üîç Workspace detectado: $WORKSPACE_PATTERN"
    echo ""
fi

# Establecer variable de entorno para que ws-switch ajuste su comportamiento
# - Usar rutas relativas en sugerencias de navegaci√≥n
export WS_STATUS_MODE=1

# Llamar a ws-switch para mostrar el estado
exec "$SCRIPT_DIR/ws-switch" "$WORKSPACE_PATTERN"
