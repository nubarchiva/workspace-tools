#!/bin/bash
# Workspace Tools - Comando principal
# Dispatcher para los subcomandos de workspace management

# Detectar directorio del script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Subcomando (primer argumento)
SUBCOMMAND=$1

# Funci√≥n de ayuda
show_help() {
    cat <<'EOF'
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Workspace Tools                                   ‚ïë
‚ïë  Sistema de gesti√≥n de workspaces nubarchiva       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Uso: ws <comando> [argumentos...]

Comandos disponibles:

  new <nombre> [repos...]
      Crea un nuevo workspace
      Ejemplos:
        ws new nuba-8400 ks-nuba libs/marc4j
        ws new faceted-search ks-nuba
        ws new master ks-nuba
        ws new develop

  add <nombre|patr√≥n> <repo>
      A√±ade un repo a un workspace existente
      Ejemplos:
        ws add nuba-8400 libs/marc4j
        ws add fac modules/docs            # coincidencia parcial
        ws add master ks-nuba

  switch [nombre|patr√≥n]
      Cambia a un workspace y muestra su informaci√≥n
      Ejemplos:
        ws switch                          # lista todos
        ws switch nuba-8400
        ws switch fac                      # coincidencia parcial
        ws switch master

  list
      Lista todos los workspaces activos
      Ejemplo:
        ws list

  clean <nombre|patr√≥n>
      Limpia un workspace (elimina worktrees, mantiene branches)
      Ejemplos:
        ws clean nuba-8400
        ws clean fac                       # coincidencia parcial
        ws clean master

Nombres especiales:
  ‚Ä¢ master   - Workspace en branch master
  ‚Ä¢ develop  - Workspace en branch develop
  ‚Ä¢ otros    - Workspace en branch feature/<nombre>

üí° B√∫squeda parcial:
  Puedes usar partes del nombre en lugar del nombre completo.
  Si hay m√∫ltiples coincidencias, se mostrar√° un men√∫ interactivo.

Compatibilidad:
  Los comandos individuales (ws-new, ws-add, etc.) siguen disponibles

Documentaci√≥n:
  README.md       - Gu√≠a completa
  EJEMPLOS.md     - Casos de uso pr√°cticos
  CHEATSHEET.md   - Referencia r√°pida
  QUICKSTART.md   - Inicio r√°pido

EOF
}

# Si no hay argumentos, mostrar ayuda
if [ -z "$SUBCOMMAND" ]; then
    show_help
    exit 0
fi

# Mapear subcomandos a scripts
case $SUBCOMMAND in
    new|add|switch|list|clean)
        SCRIPT_NAME="ws-$SUBCOMMAND"
        SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_NAME"
        
        # Verificar que el script existe
        if [ ! -f "$SCRIPT_PATH" ]; then
            echo "‚ùå Error: comando '$SUBCOMMAND' no encontrado"
            echo ""
            show_help
            exit 1
        fi
        
        # Ejecutar el script correspondiente, pasando todos los argumentos excepto el primero
        shift
        exec "$SCRIPT_PATH" "$@"
        ;;
    
    help|--help|-h)
        show_help
        exit 0
        ;;
    
    *)
        echo "‚ùå Comando desconocido: $SUBCOMMAND"
        echo ""
        show_help
        exit 1
        ;;
esac
